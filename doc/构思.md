# 毕设项目构思

## 项目介绍

基于 SDL2 实现一个 C 语言的简易 2D 游戏框架，再用该框架实现一两个游戏 demo 以展示框架功能。

## 核心模块

### 图像音频资源管理模块

实现资源管理器，管控全局的图片与音频资源。

使用 SDL2 库完成图片的加载，以及音频的加载与播放。

### 碰撞检测模块

该模块实现基础的碰撞箱组件，以及碰撞检测函数。

涉及两类算法：
- 检测算法：给定两个图形，判断它们是否有交集。这个与碰撞箱的类型有关，射线、矩形、圆之类的规则图形的碰撞检测比较好实现。
- 遍历算法：给定一个碰撞箱，遍历检测有没有与画面中的其他碰撞箱发生碰撞。

### 精灵

一个精灵，持有多个碰撞箱组件，持有多个图像资源，持有一组回调函数。

框架提供一个精灵基类，用户自定义精灵继承该基类，实现各类回调，在回调函数中编写更新状态与绘制图像的逻辑。

### 房间

精灵实例只能处于某个房间中。一个房间管理众多精灵实例。

房间管理精灵所用的数据结构与算法：
- 使用对象池管理精灵的创建销毁等。
- 使用宫格或十字链表管理对象的位移。
- 分层管理精灵的碰撞箱组件。允许只在指定层级内进行检测，减少开销。
- 分层管理精灵的图像绘制。分为背景，中景，前景三大层，分别主要负责绘制大图片背景、精灵、粒子效果。
- 每过一定时刻执行一次游戏循环，遍历精灵，执行回调，更新状态并绘制。

### UI 层与摄像机

UI 层用于绘制浮于最顶层的各类组件，比如按钮、文本、输入框等。摄像机作为 UI 层组件，当做连接房间与 UI 层的桥梁。

实现方案一：
- 组件的管理，参考 HTML 和 XML，使用多叉树组织各组件的包含关系。
- 组件的绘制，参考 CSS 标准盒模型和 HTML 文档流。
- UI 层的编写，先实现在代码中创建组件并手动挂载。如果时间充裕，则实现通过读取 HTML 或 XML 的方式来渲染界面。

UI 层的编写非常困难，如果时间来不及，我可以选择方案二。

实现方案二：
- 所有组件均已绝对定位的方式进行绘制。

### 房间切换

负责各房间之间的跳转切换（类似于 Web 的路由切换，或是小程序的页面切换）。

使用到的数据结构和算法：
- 使用栈结构管理房间调整（类似于页面栈）。
- 每个房间也都有自己的生命周期，如创建销毁、进入退出、运行暂停等。房间在不同的生命周期也会进行不同的回调（类似于 vue 的生命钩子）。

### 全局的游戏管理器

维护着一张各组件的注册表（例如 win32API 中，需要先注册窗口类，才能创建窗口实例），这张注册表记录了用户定义的各类精灵、碰撞箱组件和房间。

涉及的数据结构和算法：
- 使用多叉树结构记录精灵间的父子关系（不是类的继承关系）。执行碰撞检测时，如果要检测是否与“某类”精灵发生碰撞，可以依靠这棵树结构，遍历该类精灵的所有子类。

## 其他模块

### 日志模块

提供一组日志输出函数。因为 C 语言没有异常捕获机制，所以日志输出显得尤为重要。

### 调试模块

在编写框架时嵌入一部分用于辅助调试的代码。使用 C 语言的条件编译，选择是否开启辅助调试。

## Demo

制作一个《元气骑士》或是玩法与它相似的游戏 demo。

如果 UI 层的组件布局方式，能采用方案一完成代码编写，那可以再多制作一个视觉小说的游戏 demo。
